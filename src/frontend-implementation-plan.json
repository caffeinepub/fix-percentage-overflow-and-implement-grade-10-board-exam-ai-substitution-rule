{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Progress View per-subject percentages based on correct max-marks fields with safe fallback",
  "requirements": [
    {
      "id": "REQ-12",
      "summary": "Compute and display per-subject percentages in Progress View using entry-level per-subject max marks (regular: maxMarksPerSubject, Computer: computerMaxMarks, AI: aiMaxMarks) with a consistent fallback when max marks are missing/invalid.",
      "acceptanceCriteria": [
        "For an AcademicEntry with grade=9 and subjects.math=68 and maxMarksPerSubject=80, the UI shows 85.0% for Maths in the per-subject breakdown.",
        "If an entry has a missing/zero maxMarksPerSubject (or computerMaxMarks/aiMaxMarks for those subjects), the UI does not show an obviously wrong low percentage; it should instead show 0% or a clear fallback behavior consistent across subjects."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/ProgressView.tsx",
          "operation": "modify",
          "description": "Update per-subject percentage calculation to (1) select the correct max-marks field by subject type (regular/computer/ai), (2) guard against missing/zero/suspicious stored max marks (e.g., equal to entry.termMaxMarks or otherwise clearly not per-subject) by applying a consistent fallback (0% or grade-wise expected per-subject max), and (3) use the shared percentage utility (calculatePercentage/clampTo100 + formatPercent) so Grade 9 Maths 68/80 renders as 85.0% and bad stored max marks do not produce misleading low percentages."
        },
        {
          "path": "frontend/src/lib/maxMarks.ts",
          "operation": "modify",
          "description": "Add a small utility to derive an expected per-subject maximum for a backend subject key (e.g., 'math', 'computer', 'ai') based on grade-wise rules, so ProgressView can apply a consistent fallback when entry max-marks fields are missing/invalid."
        }
      ]
    }
  ]
}